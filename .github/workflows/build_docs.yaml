name: compile-doc
on:
    push:

jobs:
  build:
    name: compile documentation
    runs-on: ubuntu-18.04
    steps:
        - name: Fetch repository
          uses: actions/checkout@v1
        - name: Setup python
          uses: actions/setup-python@v2
        - name: Install python requirements
          uses: BSFishy/pip-action@v1
          with:
            requirements: ./docs/docs_requirements.txt
        - name: Install doxygen
          shell: bash
          run: sudo apt-get install -y doxygen
        - name: Configure
          shell: bash
          working-directory: ${{runner.workspace}}/CoreNeuron
          run: |
              mkdir BUILD && cd BUILD
              cmake -DCORENRN_ENABLE_MPI=OFF -DCORENRN_ENABLE_OPENMP=OFF ..
        - name: Compile documentation
          shell: bash
          working-directory: ${{runner.workspace}}/CoreNeuron/BUILD
          run: make docs
        - name: Archive documentation
          uses: actions/upload-artifact@v2
          with:
            name: coreneuron-doc-${{ github.sha }}
            path: BUILD/docs
        - name: Trigger RTDs build
          uses: dfm/rtds-action@v1
          with:
            webhook_url: ${{ secrets.RTDS_WEBHOOK_URL }}
            webhook_token: ${{ secrets.RTDS_WEBHOOK_TOKEN }}
            commit_ref: ${{ github.ref }}

